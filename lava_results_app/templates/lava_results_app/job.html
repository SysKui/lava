{% extends "layouts/content.html" %}
{% load django_tables2 %}
{% load i18n %}
{% load static %}
{% load utils %}

{% block content %}
    <h2>LAVA Results for {{ job_link }}
      <span
          class="label {% if job.health == job.HEALTH_COMPLETE %}label-success{% else %}label-warning{% endif %}"
          {% if job.health == job.HEALTH_COMPLETE %}title="All submitted definitions have started execution."{% endif %}>{{ job.get_state_display }}
      </span>
    </h2>

<div class="row">
  <div class="col-md-4">
    <h4 class="modal-header">Exports
        </h4>
    <dl class="dl-horizontal">
      <dt>Test results summary :</dt>
      <dd><a class="btn btn-xs btn-info" href="{% url 'lava.results.testjob_yaml_summary' job.id %}"
         title="Download test job summary as YAML"><span class="glyphicon glyphicon-download"></span> YAML</a></dd>
      <dt>Test results :</dt>
      <dd><a class="btn btn-xs btn-info" href="{% url 'lava.results.testjob_csv' job.id %}"
         title="Download results as CSV"><span class="glyphicon glyphicon-download"></span> CSV</a> or <a
              class="btn btn-xs btn-info" href="{% url 'lava.results.testjob_yaml' job.id %}"
         title="Download results as YAML"><span class="glyphicon glyphicon-download"></span> YAML</a></dd>
    </dl>
  </div>
  <div class="col-md-4">
    <h4 class="modal-header">Actions</h4>
    <a href="#" data-toggle="modal" data-target="#similar_jobs_modal" class="btn btn-primary">Similar jobs</a>
  </div>
  <div class="col-md-4">
    <h4 class="modal-header">Details</h4>
    {% if job.actual_device %}
    <dl class="dl-horizontal">
        <dt>Device :</dt>
        <dd><a href="{{ job.actual_device.get_absolute_url }}">{{ job.actual_device.hostname }}</a></dd>
    {% endif %}
{% if job.is_multinode %}
    <dl class="dl-horizontal">
{% for role in job.sub_jobs_list %}
  {% if role.id != job.id %}
     <dt>{{ role.device_role }} role:</dt>
     <dd><a href="{{ role.results_link }}">{{ role.sub_id }}</a> ({{ role.id }})</dd>
  {% else %}
     <dt>{{ role.device_role }} role:</dt>
     <dd>{{ role.sub_id }} ({{ role.id }})</dd>
  {% endif %}
{% endfor %}
{% endif %}
    </dl>
  </div>
</div>
    {% render_table suite_table %}

<div class="panel-group" id="notifications_accordion">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4><a data-toggle="collapse" data-parent="#notifications_accordion" href="#notification_collapse">
        Notifications
      </a>
      </h4>
    </div>
  {% spaceless %}
    <div id="notification_collapse" class="panel-collapse collapse">
      <div class="panel-body">
        {% if job.notification.notificationrecipient_set.all %}
        <dl class="dl-horizontal">
          {% for recipient in job.notification.notificationrecipient_set.all %}
          <dt>Recipient</dt>
          {% if recipient.method == 1 %}
          <dd>{{ recipient.irc_handle_name }} on {{ recipient.irc_server_name }}</dd>
          {% else %}
          <dd>{{ recipient.email_address }}</dd>
          {% endif %}
          <dt>Method</dt>
          <dd>{{ recipient.get_method_display }}</dd>
          <dt>Status</dt>
          <dd>{{ recipient.get_status_display }}</dd>
          <br/>
          {% endfor %}
        </dl>
        {% else %}
        No notifications for this job.
        {% endif %}
      </div>
    </div>
  {% endspaceless %}
  </div>
</div>

{% include "_similar_jobs.html" %}

{% endblock %}
{% block scripts %}
<script>
  var condition_choices = JSON.parse($("#id_condition_choices").val());
</script>
<script src="{% static "lava_server/js/jquery.typeahead.js" %}"></script>
<script src="{% static "lava_scheduler_app/js/tables.js" %}"></script>
<script src="{% static "lava_scheduler_app/js/similar-jobs.js" %}"></script>
{% endblock %}
