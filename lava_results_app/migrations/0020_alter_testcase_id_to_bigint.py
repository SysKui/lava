# Copyright (C) 2016 Linaro Limited
#
# Author: Chase Qi <chase.qi@linaro.org>
#
# SPDX-License-Identifier: GPL-2.0-or-later

# Generated by Django 3.2.19 on 2024-03-26 07:57
from django.db import migrations, models

from lava_results_app.models import QueryMaterializedView


def remove_views(apps, schema_editor):
    # Remove materialized views for all queries of content type TestCase.
    Query = apps.get_model("lava_results_app", "Query")
    db_alias = schema_editor.connection.alias
    for query in Query.objects.using(db_alias).filter(content_type__model="testcase"):
        QueryMaterializedView.drop(query.id)


def noop(apps, schema_editor):
    pass


class Migration(migrations.Migration):
    dependencies = [
        ("lava_results_app", "0019_update_query_contenttype"),
    ]

    operations = [
        migrations.RunPython(remove_views, noop),
        migrations.AlterField(
            model_name="testcase",
            name="id",
            field=models.BigAutoField(primary_key=True, serialize=False),
        ),
    ]
